{"version":3,"file":"export-modal.element-BQYYZef6.js","sources":["../../../Client/src/types/export-options.ts","../../../Client/src/services/metrics-export.service.ts","../../../Client/src/components/export-modal.element.ts"],"sourcesContent":["export enum ExportFormat {\r\n  Json = 'json',\r\n  Csv = 'csv',\r\n  Xml = 'xml'\r\n}\r\n\r\nexport enum ExportScope {\r\n  Current = 'current',\r\n  Historical = 'historical',\r\n  Custom = 'custom'\r\n}\r\n\r\nexport interface ExportOptions {\r\n  format: ExportFormat;\r\n  scope: ExportScope;\r\n  startDate?: string; // ISO string\r\n  endDate?: string; // ISO string\r\n  includePerformanceMetrics: boolean;\r\n  includeUmbracoMetrics: boolean;\r\n  includeActiveRequests: boolean;\r\n  timezone: string;\r\n}\r\n\r\nexport interface ExportResult {\r\n  fileName: string;\r\n  contentType: string;\r\n  data: ArrayBuffer;\r\n  sizeBytes: number;\r\n  generatedAt: string;\r\n}\r\n\r\nexport interface ExportProgress {\r\n  status: 'idle' | 'preparing' | 'exporting' | 'downloading' | 'complete' | 'error';\r\n  progress: number; // 0-100\r\n  message?: string;\r\n  error?: string;\r\n}","import { ExportOptions, ExportFormat, ExportScope } from '../types/export-options.js';\r\n\r\nexport class MetricsExportService {\r\n  private readonly API_BASE_URL = '/umbraco/management/api/v1/metrics';\r\n\r\n  constructor(private tokenProvider: () => Promise<string>) {}\r\n\r\n  /**\r\n   * Export metrics with custom options\r\n   */\r\n  async exportMetrics(options: ExportOptions): Promise<void> {\r\n    const token = await this.tokenProvider();\r\n    \r\n    if (!token) {\r\n      throw new Error('No authentication token available');\r\n    }\r\n\r\n    const response = await fetch(`${this.API_BASE_URL}/export`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Bearer ${token}`,\r\n      },\r\n      body: JSON.stringify(options),\r\n    });\r\n\r\n    if (!response.ok) {\r\n      if (response.status === 400) {\r\n        const error = await response.json();\r\n        throw new Error(error.detail || 'Invalid export configuration');\r\n      }\r\n      \r\n      throw new Error(\r\n        `Failed to export metrics: ${response.status} ${response.statusText}`\r\n      );\r\n    }\r\n\r\n    // Trigger file download\r\n    await this.downloadFile(response);\r\n  }\r\n\r\n  /**\r\n   * Export performance metrics only\r\n   */\r\n  async exportPerformanceMetrics(format: ExportFormat = ExportFormat.Json): Promise<void> {\r\n    const token = await this.tokenProvider();\r\n    \r\n    const response = await fetch(\r\n      `${this.API_BASE_URL}/export/performance?format=${format}`,\r\n      {\r\n        method: 'POST',\r\n        headers: {\r\n          'Authorization': `Bearer ${token}`,\r\n        },\r\n      }\r\n    );\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`Failed to export performance metrics: ${response.statusText}`);\r\n    }\r\n\r\n    await this.downloadFile(response);\r\n  }\r\n\r\n  /**\r\n   * Export Umbraco metrics only\r\n   */\r\n  async exportUmbracoMetrics(format: ExportFormat = ExportFormat.Json): Promise<void> {\r\n    const token = await this.tokenProvider();\r\n    \r\n    const response = await fetch(\r\n      `${this.API_BASE_URL}/export/umbraco?format=${format}`,\r\n      {\r\n        method: 'POST',\r\n        headers: {\r\n          'Authorization': `Bearer ${token}`,\r\n        },\r\n      }\r\n    );\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`Failed to export Umbraco metrics: ${response.statusText}`);\r\n    }\r\n\r\n    await this.downloadFile(response);\r\n  }\r\n\r\n  /**\r\n   * Quick export with default options\r\n   */\r\n  async quickExport(\r\n    includePerformance: boolean = true,\r\n    includeUmbraco: boolean = true,\r\n    format: ExportFormat = ExportFormat.Csv\r\n  ): Promise<void> {\r\n    const options: ExportOptions = {\r\n      format,\r\n      scope: ExportScope.Current,\r\n      includePerformanceMetrics: includePerformance,\r\n      includeUmbracoMetrics: includeUmbraco,\r\n      includeActiveRequests: false,\r\n      timezone: 'UTC'\r\n    };\r\n\r\n    await this.exportMetrics(options);\r\n  }\r\n\r\n  /**\r\n   * Download file from response\r\n   */\r\n  private async downloadFile(response: Response): Promise<void> {\r\n    // Get filename from Content-Disposition header or generate one\r\n    const contentDisposition = response.headers.get('Content-Disposition');\r\n    let filename = 'metrics-export';\r\n    \r\n    if (contentDisposition) {\r\n      const filenameMatch = contentDisposition.match(/filename=\"?([^\"]+)\"?/);\r\n      if (filenameMatch && filenameMatch[1]) {\r\n        filename = filenameMatch[1];\r\n      }\r\n    }\r\n\r\n    // Get blob and create download link\r\n    const blob = await response.blob();\r\n    const url = window.URL.createObjectURL(blob);\r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n  a.target = '_blank';\r\n    a.download = filename;\r\n    document.body.appendChild(a);\r\n    a.click();\r\n    \r\n    // Cleanup\r\n    window.URL.revokeObjectURL(url);\r\n    document.body.removeChild(a);\r\n  }\r\n\r\n  /**\r\n   * Get file size estimate for export\r\n   */\r\n  estimateFileSize(options: ExportOptions): string {\r\n    // Simple estimation based on format and included metrics\r\n    let estimatedSize = 0;\r\n    \r\n    // Base size for current snapshot\r\n    if (options.includePerformanceMetrics) estimatedSize += 5; // ~5KB for performance metrics\r\n    if (options.includeUmbracoMetrics) estimatedSize += 3; // ~3KB for Umbraco metrics\r\n    if (options.includeActiveRequests) estimatedSize += 2; // ~2KB for active requests\r\n    \r\n    // Adjust for historical data\r\n    if (options.scope === ExportScope.Historical || options.scope === ExportScope.Custom) {\r\n      // Historical data is much larger - estimate based on number of records\r\n      // Assume ~1KB per performance metric record for historical data\r\n      if (options.includePerformanceMetrics) {\r\n        // For historical scope, estimate last 30 days with 5-second intervals\r\n        if (options.scope === ExportScope.Historical) {\r\n          estimatedSize += 30 * 24 * 60 * 60 / 5 * 1; // 30 days * 24 hours * 60 minutes * 60 seconds / 5 second intervals * 1KB\r\n        } else if (options.scope === ExportScope.Custom && options.startDate && options.endDate) {\r\n          // For custom scope, estimate based on date range\r\n          const start = new Date(options.startDate);\r\n          const end = new Date(options.endDate);\r\n          const days = Math.max(1, Math.ceil((end.getTime() - start.getTime()) / (1000 * 60 * 60 * 24)));\r\n          estimatedSize += days * 24 * 60 * 60 / 5 * 1; // days * 24 hours * 60 minutes * 60 seconds / 5 second intervals * 1KB\r\n        }\r\n      }\r\n      \r\n      // Note: Historical Umbraco metrics not implemented yet\r\n      if (options.includeUmbracoMetrics) {\r\n        estimatedSize += 0; // No historical Umbraco metrics storage yet\r\n      }\r\n    }\r\n    \r\n    // Format multipliers\r\n    switch (options.format) {\r\n      case ExportFormat.Json:\r\n        estimatedSize *= 1.2; // JSON is slightly larger\r\n        break;\r\n      case ExportFormat.Csv:\r\n        estimatedSize *= 0.8; // CSV is more compact\r\n        break;\r\n      case ExportFormat.Xml:\r\n        estimatedSize *= 1.5; // XML has more markup\r\n        break;\r\n    }\r\n    \r\n    if (estimatedSize < 1) {\r\n      return '< 1 KB';\r\n    } else if (estimatedSize < 1024) {\r\n      return `${Math.round(estimatedSize)} KB`;\r\n    } else if (estimatedSize < 1024 * 1024) {\r\n      return `${(estimatedSize / 1024).toFixed(1)} MB`;\r\n    } else {\r\n      return `${(estimatedSize / (1024 * 1024)).toFixed(1)} GB`;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get supported formats for display\r\n   */\r\n  getSupportedFormats(): Array<{ value: ExportFormat; label: string; description: string }> {\r\n    return [\r\n      {\r\n        value: ExportFormat.Json,\r\n        label: 'JSON',\r\n        description: 'Structured data format, good for APIs and programming'\r\n      },\r\n      {\r\n        value: ExportFormat.Csv,\r\n        label: 'CSV',\r\n        description: 'Spreadsheet format, good for Excel and data analysis'\r\n      },\r\n      {\r\n        value: ExportFormat.Xml,\r\n        label: 'XML',\r\n        description: 'Markup format, good for legacy systems'\r\n      }\r\n    ];\r\n  }\r\n\r\n  /**\r\n   * Get export scope options\r\n   */\r\n  getScopeOptions(): Array<{ value: ExportScope; label: string; description: string }> {\r\n    return [\r\n      {\r\n        value: ExportScope.Current,\r\n        label: 'Current Snapshot',\r\n        description: 'Export current metrics only'\r\n      },\r\n      {\r\n        value: ExportScope.Historical,\r\n        label: 'Historical Data',\r\n        description: 'Export historical metrics (requires storage)'\r\n      },\r\n      {\r\n        value: ExportScope.Custom,\r\n        label: 'Custom Range',\r\n        description: 'Export metrics from specific date range'\r\n      }\r\n    ];\r\n  }\r\n}","import {\r\n  css,\r\n  unsafeCSS,\r\n  html,\r\n  customElement,\r\n  state,\r\n} from \"@umbraco-cms/backoffice/external/lit\";\r\nimport { UmbModalElement } from \"@umbraco-cms/backoffice/modal\";\r\nimport { UMB_NOTIFICATION_CONTEXT } from \"@umbraco-cms/backoffice/notification\";\r\nimport { UMB_AUTH_CONTEXT } from \"@umbraco-cms/backoffice/auth\";\r\nimport { MetricsExportService } from \"../services/metrics-export.service.js\";\r\nimport { ExportFormat, ExportScope, ExportOptions } from \"../types/export-options.js\";\r\nimport { UUIModalElement } from \"@umbraco-cms/backoffice/external/uui\";\r\nimport stylesString from '../css/export-modal.styles.css?inline';\r\n\r\n@customElement(\"umbmetrics-export-modal\")\r\nexport class UmbMetricsExportModalElement extends UmbModalElement {\r\n  modalContext: any;\r\n\r\n  @state()\r\n  private _isExporting: boolean = false;\r\n\r\n  @state()\r\n  private _exportProgress: number = 0;\r\n\r\n  @state()\r\n  private _exportOptions: ExportOptions = {\r\n    format: ExportFormat.Csv,\r\n    scope: ExportScope.Current,\r\n    includePerformanceMetrics: true,\r\n    includeUmbracoMetrics: true,\r\n    includeActiveRequests: false,\r\n    timezone: 'UTC'\r\n  };\r\n\r\n  @state()\r\n  private _estimatedSize: string = '';\r\n\r\n  #exportService?: MetricsExportService;\r\n  #notificationContext?: typeof UMB_NOTIFICATION_CONTEXT.TYPE;\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this.consumeContext(UMB_NOTIFICATION_CONTEXT, (notificationContext) => {\r\n      this.#notificationContext = notificationContext;\r\n    });\r\n\r\n    this.consumeContext(UMB_AUTH_CONTEXT, (authContext) => {\r\n      this.#exportService = new MetricsExportService(async () => {\r\n        const token = await authContext?.getLatestToken();\r\n        if (!token) {\r\n          throw new Error('No authentication token available');\r\n        }\r\n        return token;\r\n      });\r\n    });\r\n\r\n    // Calculate initial estimated size\r\n    this.#updateEstimatedSize();\r\n  }\r\n\r\n  #updateEstimatedSize() {\r\n    if (this.#exportService) {\r\n      this._estimatedSize = this.#exportService.estimateFileSize(this._exportOptions);\r\n    }\r\n  }\r\n\r\n  #handleExport = async () => {\r\n    if (!this.#exportService || this._isExporting) {\r\n      return;\r\n    }\r\n\r\n    this._isExporting = true;\r\n    this._exportProgress = 10;\r\n\r\n    try {\r\n      // Validate date range if custom scope\r\n      if (this._exportOptions.scope === ExportScope.Custom) {\r\n        if (!this._exportOptions.startDate || !this._exportOptions.endDate) {\r\n          throw new Error('Both start and end dates are required for custom range');\r\n        }\r\n        \r\n        const start = new Date(this._exportOptions.startDate);\r\n        const end = new Date(this._exportOptions.endDate);\r\n        \r\n        if (start > end) {\r\n          throw new Error('Start date must be before end date');\r\n        }\r\n      }\r\n\r\n      this._exportProgress = 30;\r\n      \r\n      await this.#exportService.exportMetrics(this._exportOptions);\r\n      \r\n      this._exportProgress = 100;\r\n      \r\n      if (this.#notificationContext) {\r\n        this.#notificationContext.peek(\"positive\", {\r\n          data: {\r\n            headline: \"Export Complete\",\r\n            message: `Metrics exported successfully (${this._estimatedSize})`,\r\n          },\r\n        });\r\n      }\r\n\r\n      // Close modal after short delay\r\n      setTimeout(() => {\r\n        if (this.modalContext) {\r\n          this.modalContext.submit();\r\n        }\r\n      }, 1000);\r\n\r\n    } catch (error) {\r\n      console.error('Export error:', error);\r\n      \r\n      if (this.#notificationContext) {\r\n        this.#notificationContext.peek(\"danger\", {\r\n          data: {\r\n            headline: \"Export Failed\",\r\n            message: error instanceof Error \r\n              ? error.message \r\n              : \"Failed to export metrics. Please try again.\",\r\n          },\r\n        });\r\n      }\r\n      \r\n      this._isExporting = false;\r\n      this._exportProgress = 0;\r\n    }\r\n  };\r\n\r\n  #handleQuickExport = async (format: ExportFormat) => {\r\n    if (!this.#exportService || this._isExporting) {\r\n      return;\r\n    }\r\n\r\n    this._isExporting = true;\r\n\r\n    try {\r\n      await this.#exportService.quickExport(true, true, format);\r\n      \r\n      if (this.#notificationContext) {\r\n        this.#notificationContext.peek(\"positive\", {\r\n          data: {\r\n            headline: \"Export Complete\",\r\n            message: `Quick export to ${format.toUpperCase()} completed`,\r\n          },\r\n        });\r\n      }\r\n\r\n      // Close modal\r\n      if (this.modalContext) {\r\n        this.modalContext.submit();\r\n      }\r\n\r\n    } catch (error) {\r\n      console.error('Quick export error:', error);\r\n      \r\n      if (this.#notificationContext) {\r\n        this.#notificationContext.peek(\"danger\", {\r\n          data: {\r\n            headline: \"Export Failed\",\r\n            message: error instanceof Error \r\n              ? error.message \r\n              : \"Failed to export metrics\",\r\n          },\r\n        });\r\n      }\r\n    } finally {\r\n      this._isExporting = false;\r\n    }\r\n  };\r\n\r\n  #handleCancel = () => {\r\n    if (this.modalContext) {\r\n      this.modalContext.reject();\r\n    }\r\n  };\r\n\r\n  render() {\r\n    // Get format and scope options from service or use defaults\r\n    const formatOptions = this.#exportService?.getSupportedFormats() || [\r\n      { value: ExportFormat.Json, label: 'JSON', description: 'Structured data format' },\r\n      { value: ExportFormat.Csv, label: 'CSV', description: 'Spreadsheet format' },\r\n      { value: ExportFormat.Xml, label: 'XML', description: 'Markup format' }\r\n    ];\r\n    \r\n    const scopeOptions = this.#exportService?.getScopeOptions() || [\r\n      { value: ExportScope.Current, label: 'Current Snapshot', description: 'Export current metrics only' },\r\n      { value: ExportScope.Historical, label: 'Historical Data', description: 'Export historical metrics' },\r\n      { value: ExportScope.Custom, label: 'Custom Range', description: 'Export metrics from specific date range' }\r\n    ];\r\n\r\n    return html`\r\n      <umb-modal-sidebar>\r\n        <umb-body-layout headline=\"Export Metrics\">\r\n          <div id=\"main\">\r\n            <umbmetrics-quick-export-buttons\r\n              .disabled=\"${this._isExporting}\"\r\n              .onCsvExport=\"${() => this.#handleQuickExport(ExportFormat.Csv)}\"\r\n              .onJsonExport=\"${() => this.#handleQuickExport(ExportFormat.Json)}\"\r\n            ></umbmetrics-quick-export-buttons>\r\n            \r\n            <div class=\"divider\">\r\n              <span>or</span>\r\n            </div>\r\n            \r\n            <umbmetrics-export-options\r\n              .exportOptions=\"${this._exportOptions}\"\r\n              .disabled=\"${this._isExporting}\"\r\n              .estimatedSize=\"${this._estimatedSize}\"\r\n              .formatOptions=\"${formatOptions}\"\r\n              .scopeOptions=\"${scopeOptions}\"\r\n              .onFormatChange=\"${(format: ExportFormat) => {\r\n                this._exportOptions = { ...this._exportOptions, format };\r\n                this.#updateEstimatedSize();\r\n              }}\"\r\n              .onScopeChange=\"${(scope: ExportScope) => {\r\n                this._exportOptions = { ...this._exportOptions, scope };\r\n              }}\"\r\n              .onMetricToggle=\"${(metric: keyof ExportOptions) => {\r\n                this._exportOptions = {\r\n                  ...this._exportOptions,\r\n                  [metric]: !this._exportOptions[metric]\r\n                };\r\n                this.#updateEstimatedSize();\r\n              }}\"\r\n              .onDateChange=\"${(dateField: 'startDate' | 'endDate', value: string) => {\r\n                this._exportOptions = {\r\n                  ...this._exportOptions,\r\n                  [dateField]: value || undefined\r\n                };\r\n              }}\"\r\n              .onTimezoneChange=\"${(timezone: string) => {\r\n                this._exportOptions = { ...this._exportOptions, timezone };\r\n              }}\"\r\n            ></umbmetrics-export-options>\r\n            \r\n            <umbmetrics-export-progress\r\n              .isExporting=\"${this._isExporting}\"\r\n              .progress=\"${this._exportProgress}\"\r\n            ></umbmetrics-export-progress>\r\n          </div>\r\n          \r\n          <div slot=\"actions\">\r\n            <uui-button \r\n              look=\"secondary\"\r\n              @click=\"${this.#handleCancel}\"\r\n              ?disabled=\"${this._isExporting}\"\r\n            >\r\n              Cancel\r\n            </uui-button>\r\n            \r\n            <uui-button \r\n              look=\"primary\"\r\n              color=\"positive\"\r\n              @click=\"${this.#handleExport}\"\r\n              ?disabled=\"${this._isExporting || (!this._exportOptions.includePerformanceMetrics && !this._exportOptions.includeUmbracoMetrics)}\"\r\n            >\r\n              ${this._isExporting ? html`\r\n                <uui-icon name=\"icon-time\"></uui-icon>\r\n                Exporting...\r\n              ` : html`\r\n                <uui-icon name=\"icon-download\"></uui-icon>\r\n                Export Metrics\r\n              `}\r\n            </uui-button>\r\n          </div>\r\n        </umb-body-layout>\r\n      </umb-modal-sidebar>\r\n    `;\r\n  }\r\n\r\n  static styles = [...UUIModalElement.styles, css`${unsafeCSS(stylesString)}`];\r\n}\r\n\r\nexport default UmbMetricsExportModalElement;\r\n\r\ndeclare global {\r\n  interface HTMLElementTagNameMap {\r\n    \"umbmetrics-export-modal\": UmbMetricsExportModalElement;\r\n  }\r\n}\r\n"],"names":["ExportFormat","ExportScope","MetricsExportService","tokenProvider","options","token","response","error","format","includePerformance","includeUmbraco","contentDisposition","filename","filenameMatch","blob","url","a","estimatedSize","start","end","days","_exportService","_notificationContext","_UmbMetricsExportModalElement_instances","updateEstimatedSize_fn","_handleExport","_handleQuickExport","_handleCancel","UmbMetricsExportModalElement","UmbModalElement","__privateAdd","__privateGet","UMB_NOTIFICATION_CONTEXT","notificationContext","__privateSet","UMB_AUTH_CONTEXT","authContext","__privateMethod","formatOptions","scopeOptions","html","scope","metric","dateField","value","timezone","UUIModalElement","css","unsafeCSS","stylesString","__decorateClass","state","customElement","UmbMetricsExportModalElement_default"],"mappings":"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"}